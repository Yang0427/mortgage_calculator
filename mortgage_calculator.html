<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mortgage Loan Calculator</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Calculate mortgage payments, interest savings, and loan payoff scenarios">
    <meta name="theme-color" content="#2d5a27">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mortgage Calculator">
    <meta name="msapplication-TileColor" content="#2d5a27">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-192x192.png">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="calculator-panel">
            <div class="section">
                <div class="section-header">Loan Detail</div>
                <div class="section-content">
                    <div class="input-group">
                        <label for="snpPrice">SNP Price:</label>
                        <input type="number" id="snpPrice" value="800000" step="1000">
                    </div>
                    <div class="input-group">
                        <label for="loanMargin">Loan Margin (%):</label>
                        <input type="number" id="loanMargin" value="90" step="1" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="loanAmount">Loan Amount:</label>
                        <input type="number" id="loanAmount" value="720000" step="1000" readonly>
                    </div>
                    <div class="input-group">
                        <label for="interestRate">Annual Interest Rate (%):</label>
                        <input type="number" id="interestRate" value="4.00" step="0.01" min="0">
                    </div>
                    <div class="input-group">
                        <label for="loanPeriod">Loan Period (Years):</label>
                        <input type="number" id="loanPeriod" value="35" step="1" min="1">
                    </div>
                    <div class="input-group">
                        <label for="extraPayment">Extra Monthly Payment:</label>
                        <input type="number" id="extraPayment" value="200" step="10" min="0">
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">Loan Summary</div>
                <div class="section-content">
                    <div class="output-group">
                        <label>Monthly Payment:</label>
                        <span class="value" id="monthlyPayment">RM 0.00</span>
                    </div>
                    <div class="output-group">
                        <label>Number of Payments:</label>
                        <span class="value" id="numPayments">0</span>
                    </div>
                    <div class="output-group">
                        <label>Total Interest:</label>
                        <span class="value" id="totalInterest">RM 0.00</span>
                    </div>
                    <div class="output-group">
                        <label>Interest Saving:</label>
                        <span class="value" id="interestSaving">RM 0.00</span>
                    </div>
                    <div class="output-group">
                        <label>Payoff Earlier By:</label>
                        <span class="value" id="payoffEarlier">0 years 0 months</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="chart-panel">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color legend-principal"></div>
                    <span>Principal (ÊØçÈáë)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-interest"></div>
                    <span>Interest (Âà©ÊÅØ)</span>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="paymentChart"></canvas>
            </div>
            <div class="arrow">‚Üí</div>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installButton = document.createElement('button');
            installButton.textContent = 'üì± Install App';
            installButton.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #2d5a27;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 25px;
                font-size: 14px;
                cursor: pointer;
                z-index: 1000;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            `;
            
            installButton.addEventListener('click', () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    installButton.remove();
                });
            });
            
            document.body.appendChild(installButton);
        });

        // Offline Storage
        function saveToStorage() {
            const data = {
                snpPrice: document.getElementById('snpPrice').value,
                loanMargin: document.getElementById('loanMargin').value,
                interestRate: document.getElementById('interestRate').value,
                loanPeriod: document.getElementById('loanPeriod').value,
                extraPayment: document.getElementById('extraPayment').value
            };
            localStorage.setItem('mortgageCalculatorData', JSON.stringify(data));
        }

        function loadFromStorage() {
            const data = localStorage.getItem('mortgageCalculatorData');
            if (data) {
                const parsed = JSON.parse(data);
                document.getElementById('snpPrice').value = parsed.snpPrice || 800000;
                document.getElementById('loanMargin').value = parsed.loanMargin || 90;
                document.getElementById('interestRate').value = parsed.interestRate || 4.00;
                document.getElementById('loanPeriod').value = parsed.loanPeriod || 35;
                document.getElementById('extraPayment').value = parsed.extraPayment || 200;
            }
        }

        // Load saved data on page load
        window.addEventListener('load', loadFromStorage);
    </script>
</body>
</html>
